<script type="text/javascript">
  RED.nodes.registerType("satel-integra-encoder", {
    category: "function",
    color: "#c0c0c0",
    defaults: {
      name: { value: "Satel Integra encoder" },
      user: { value: "", type: "satel-integra-user", required: false },
      prefix: {
        value: "",
        type: "satel-integra-security_prefix",
        required: false,
      },
    },
    inputs: 1,
    outputs: 1,
    icon: "function.png",
    label: function () {
      return this.name || "Satel Integra encoder";
    },
  });
</script>

<script type="text/html" data-template-name="satel-integra-encoder">
  <div class="form-row">
    <label for="node-input-name"><i class="icon-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-user"><i class="icon-tag"></i> User</label>
    <input type="text" id="node-input-user">
  </div>
  <div class="form-row">
    <label for="node-input-prefix"><i class="icon-tag"></i> Security prefix</label>
    <input type="text" id="node-input-prefix">
  </div>
</script>

<script type="text/html" data-help-name="satel-integra-encoder">
  <p>
    A node that encodes protocol frames and sends them out as a buffer of bytes stored in the
    message payload. The type of message to encode should be stored in the <code>msg.topic</code>
    property.
  </p>
  <p>
    Properties:
    <ul>
      <li>
        <b>User</b> - security system user which will be used to authorize commands requiring
        authorization.
      </li>
      <li>
        <b>Security prefix</b> - security prefix which will be added at the beginning of the
        authorization token. The authorization token which is sent to the Integra system is the
        concatenation of the security prefix and the user code.
      </li>
    </ul>
  </p>
  <p>
    The supported message types are:
    <ul>
      <li>
        <dfn>New data command [0x7F]</dfn> - <code>msg.topic</code> must be set to <b>new_data</b>.
      </li>
      <li>
        <dfn>Outputs state command [0x17]</dfn> - <code>msg.topic</code> must be set to
        <b>outputs_state</b>.
      </li>
      <li>
        <dfn>Zones tamper command [0x01]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_tamper</b>.
      </li>
      <li>
        <dfn>Zones violation command [0x00]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_violation</b>.
      </li>
      <li>
        <dfn>Zones alarm command [0x02]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_alarm</b>.
      </li>
      <li>
        <dfn>Zones tamper alarm command [0x03]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_tamper_alarm</b>.
      </li>
      <li>
        <dfn>Zones alarm memory command [0x04]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_alarm_memory</b>.
      </li>
      <li>
        <dfn>Zones tamper alarm memory command [0x05]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_tamper_alarm_memory</b>.
      </li>
      <li>
        <dfn>Zones bypass status command [0x06]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_bypass_status</b>.
      </li>
      <li>
        <dfn>Zones no violation trouble command [0x07]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_no_violation_trouble</b>.
      </li>
      <li>
        <dfn>Zones long violation trouble command [0x08]</dfn> - <code>msg.topic</code> must be set
        to <b>zones_long_violation_trouble</b>.
      </li>
      <li>
        <dfn>Zones isolate state command [0x26]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_isolate_state</b>.
      </li>
      <li>
        <dfn>Zones masked command [0x28]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_masked</b>.
      </li>
      <li>
        <dfn>Zones masked memory command [0x29]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_masked_memory</b>.
      </li>
      <li>
        <dfn>Outputs on command [0x88]</dfn> - <code>msg.topic</code> must be set to
        <b>outputs_on</b>. Additionally the following properties are mandatory:
        <ul>
          <li>
            <code>msg.prefixAndUserCode</code> - 16 character long string containing (optional)
            prefix followed by user code. If length of prefix + length of user code is less than
            16 characters, remaining characters should be filled with <i>'f'</i>. E.g. for
            prefix: <i>"0346"</i> and user code: <i>"7696"</i>, the property value should be
            <i>"03467696ffffffff"</i>.
            <b>Note</b>, this way of authorization is <b>deprecated</b>.Use <code>User</code> and
            <code>Prefix</code> properties instead.
          </li>
          <li>
            <code>msg.outputs</code> - 128 or 256 elements long boolean array. Index of an element
            is equal to index of the output. Outputs for which their corresponding array element is
            set to <i>true</i>, will be turned on. The other outputs will remain unchanged.
          </li>
        </ul>
      </li>
      <li>
        <dfn>Outputs off command [0x89]</dfn> - <code>msg.topic</code> must be set to
        <b>outputs_off</b>. Additionally the following properties are mandatory:
        <ul>
          <li>
            <code>msg.prefixAndUserCode</code> - 16 character long string containing (optional)
            prefix followed by user code. If length of prefix + length of user code is less than
            16 characters, remaining characters should be filled with <i>'f'</i>. E.g. for
            prefix: <i>"0346"</i> and user code: <i>"7696"</i>, the property value should be
            <i>"03467696ffffffff"</i>.
            <b>Note</b>, this way of authorization is <b>deprecated</b>.Use <code>User</code> and
            <code>Prefix</code> properties instead.
          </li>
          <li>
            <code>msg.outputs</code> - 128 or 256 elements long boolean array. Index of an element
            is equal to index of the output. Outputs for which their corresponding array element is
            set to <i>true</i>, will be turned off. The other outputs will remain unchanged.
          </li>
        </ul>
      </li>
      <li>
        <dfn>Outputs switch command [0x91]</dfn> - <code>msg.topic</code> must be set to
        <b>outputs_switch</b>. Additionally the following properties are mandatory:
        <ul>
          <li>
            <code>msg.prefixAndUserCode</code> - 16 character long string containing (optional)
            prefix followed by user code. If length of prefix + length of user code is less than
            16 characters, remaining characters should be filled with <i>'f'</i>. E.g. for
            prefix: <i>"0346"</i> and user code: <i>"7696"</i>, the property value should be
            <i>"03467696ffffffff"</i>.
            <b>Note</b>, this way of authorization is <b>deprecated</b>.Use <code>User</code> and
            <code>Prefix</code> properties instead.
          </li>
          <li>
            <code>msg.outputs</code> - 128 or 256 elements long boolean array. Index of an element
            is equal to index of the output. Outputs for which their corresponding array element is
            set to <i>true</i>, will be toggled. The other outputs will remain unchanged.
          </li>
        </ul>
      </li>
      <li>
        <dfn>Zones bypass command [0x86]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_bypass</b>. Additionally the following properties are mandatory:
        <ul>
          <li>
            <code>msg.zones</code> - 128 or 256 elements long boolean array. Index of an element
            is equal to index of the zone. Zones for which their corresponding array element is
            set to <i>true</i>, will be bypassed. The other zones will remain unchanged.
          </li>
        </ul>
      </li>
      <li>
        <dfn>Zones unbypass command [0x87]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_unbypass</b>. Additionally the following properties are mandatory:
        <ul>
          <li>
            <code>msg.zones</code> - 128 or 256 elements long boolean array. Index of an element
            is equal to index of the zone. Zones for which their corresponding array element is
            set to <i>true</i>, will be unbypassed. The other zones will remain unchanged.
          </li>
        </ul>
      </li>
      <li>
        <dfn>Zones isolate command [0x90]</dfn> - <code>msg.topic</code> must be set to
        <b>zones_isolate</b>. Additionally the following properties are mandatory:
        <ul>
          <li>
            <code>msg.zones</code> - 128 or 256 elements long boolean array. Index of an element
            is equal to index of the zone. Zones for which their corresponding array element is
            set to <i>true</i>, will be isolated. The other zones will remain unchanged.
          </li>
        </ul>
      </li>
    </ul>
  </p>
</script>
